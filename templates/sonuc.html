<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <title>Johari Testi Sonu√ßlarƒ±</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg1: #fdfcfb;
            --bg2: #e2d1c3;
            --ink: #1f2937;
            --muted: #6b7280;
            --fine: #9aa3b2;
            --accent: #8b5cf6;
            --accent2: #6a1b9a;
            --ok: #10b981;
            --warn: #f59e0b;
            --card: rgba(255, 255, 255, .92);
            --border: #e8e6f3;
            --shadow: 0 20px 60px rgba(30, 10, 60, .15);
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            color: var(--ink);
            background:
                radial-gradient(900px 500px at 10% 10%, rgba(139, 92, 246, .10), transparent 60%),
                linear-gradient(120deg, var(--bg1), var(--bg2));
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 28px 16px;
        }

        /* Shell + glass */
        .shell {
            width: min(1100px, 98vw);
            padding: 1px;
            border-radius: 24px;
            background: linear-gradient(120deg, rgba(139, 92, 246, .35), rgba(124, 58, 237, .18), rgba(139, 92, 246, .10));
            box-shadow: var(--shadow);
        }

        .kapsayici {
            border-radius: 23px;
            background: var(--card);
            backdrop-filter: saturate(120%) blur(5px);
            overflow: hidden
        }

        /* Header */
        .header {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 12px;
            padding: 26px 28px;
            border-bottom: 1px solid var(--border)
        }

        h1 {
            margin: 0;
            font-size: 28px;
            letter-spacing: .2px
        }

        .pair {
            color: var(--muted);
            font-weight: 600;
            margin-top: 6px
        }

        .chip {
            align-self: start;
            background: #f3e8ff;
            color: #6b21a8;
            font-weight: 700;
            font-size: 12px;
            padding: 8px 12px;
            border-radius: 999px
        }

        /* Grid */
        .grid {
            display: grid;
            grid-template-columns: 1.25fr .95fr;
            gap: 18px;
            padding: 22px 22px
        }

        @media (max-width:960px) {
            .grid {
                grid-template-columns: 1fr
            }
        }

        .card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 8px 26px rgba(0, 0, 0, .06)
        }

        .card h3 {
            margin: 0 0 10px;
            font-size: 18px
        }

        /* Graph */
        .grafik {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px
        }

        .grafik img {
            max-width: 100%;
            border-radius: 12px;
            border: 3px solid #e8defa
        }

        /* Stats rings */
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px
        }

        @media (max-width:560px) {
            .stats {
                grid-template-columns: 1fr 1fr
            }
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 14px;
            background: #fafaff
        }

        .ring {
            --pct: 0;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background:
                conic-gradient(var(--accent) calc(var(--pct)*1%), #ede9fe 0),
                radial-gradient(circle 28px, #fff 98%, transparent 100%);
            display: grid;
            place-items: center;
            font-weight: 800;
            color: #4b5563;
        }

        .stat .txt {
            line-height: 1.45
        }

        .stat .txt b {
            display: block;
            font-size: 14px
        }

        .stat .txt span {
            color: var(--muted);
            font-size: 12px
        }

        /* Actions */
        .actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center
        }

        .btn,
        .alink {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: linear-gradient(90deg, var(--accent), var(--accent2));
            color: #fff;
            font-weight: 700;
            text-decoration: none;
            cursor: pointer;
            box-shadow: 0 12px 30px rgba(124, 58, 237, .28);
            transition: transform .08s ease, box-shadow .2s ease, filter .2s ease
        }

        .btn:hover,
        .alink:hover {
            transform: translateY(-2px);
            box-shadow: 0 18px 34px rgba(124, 58, 237, .34);
            filter: saturate(1.05)
        }

        .btn.secondary {
            background: #fff;
            color: #334155;
            border-color: #e2e8f0;
            box-shadow: none;
        }

        .btn.secondary:hover {
            box-shadow: 0 8px 22px rgba(0, 0, 0, .08)
        }

        .hint {
            font-size: 12px;
            color: var(--fine)
        }

        /* Email card */
        .mail {
            display: grid;
            gap: 10px
        }

        .mail label {
            font-weight: 700;
            color: #374151
        }

        .mail input[type="email"] {
            padding: 12px 14px;
            border-radius: 12px;
            border: 1px solid #d1d5db;
            outline: none
        }

        .mail input[type="email"]:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, .20)
        }

        .mail .row {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap
        }

        /* Comment / Story */
        .ai {
            border-left: 5px solid var(--accent2);
            background: #fff;
            padding: 16px;
            border-radius: 12px
        }

        .story {
            margin-top: 12px
        }

        .story summary {
            list-style: none;
            cursor: pointer;
            padding: 12px 14px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: #fafafa;
            font-weight: 700;
            color: #4b5563;
        }

        .story summary::marker {
            display: none
        }

        .story[open] summary {
            background: #f4f0ff
        }

        /* Flash */
        .flash {
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 14px;
            font-weight: 600
        }

        .success {
            background: #e6f9e6;
            color: #27632a;
            border: 1px solid #a5d6a7
        }

        .error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a
        }

        /* Footer strip */
        .foot {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            padding: 12px 22px;
            border-top: 1px solid var(--border);
            background: #fff
        }

        .foot small {
            color: var(--fine)
        }
    </style>
</head>

<body>
    <div class="shell">
        <div class="kapsayici">
            <!-- Flash -->
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div style="padding:16px 22px 0">
                {% for category, message in messages %}
                <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}

            <!-- Header -->
            <div class="header">
                <div>
                    <h1>Johari Testi Sonu√ßlarƒ±</h1>
                    <div class="pair">{{ yapan }} ‚Üí {{ test_edilen }}</div>
                </div>
                <div class="chip">Johari ‚Ä¢ 48 Soru</div>
            </div>

            <!-- Content -->
            <div class="grid">
                <!-- Left: Graph + Actions + Story -->
                <div class="card">
                    <h3>Johari Penceresi</h3>
                    <div class="grafik">
                        <img src="{{ url_for('static', filename=grafik_path) }}" alt="Johari Penceresi Grafiƒüi">
                    </div>

                    <div class="actions" style="margin-top:8px">
                        <a class="alink" href="{{ url_for('indir_benim_sonucum') }}">‚¨áÔ∏è Excel</a>

                        <button class="btn secondary" type="button" id="printBtn">üñ®Ô∏è PDF‚Äôe Yazdƒ±r</button>
                        <a class="btn secondary" href="{{ url_for('giris') }}">‚Ü©Ô∏è Yeniden Dene</a>
                    </div>
                    <div class="hint" style="margin-top:6px">ƒ∞pucu: PDF yazdƒ±r se√ßeneƒüiyle bu sayfayƒ± doƒürudan PDF
                        olarak kaydedebilirsin.</div>

                    <!-- SADECE BURASI DEƒûƒ∞≈ûTƒ∞: open kaldƒ±rƒ±ldƒ± ve id eklendi -->
                    <details class="story" id="hikayeBox">
                        <summary>üìñ Zafer Bey‚Äôin Hikayesi</summary>

                        <!-- Ba≈üta gizli; JS ilk a√ßƒ±lƒ±≈üta paragraflara d√∂n√º≈üt√ºr√ºp g√∂sterecek -->
                        <div class="ai" id="hikayeMetni" style="margin-top:10px; display:none;">
                            <h3 style="margin:0 0 8px">Bilinenden Bilinmeyene: K√º√ß√ºk Bir D√∂n√º≈ü√ºm</h3>
                            Zafer beyin hikayesi : Zafer Bey‚Äôin farklƒ± bir k√ºt√ºphaneci olacaƒüƒ± hen√ºz √ºniversitede
                            √∂ƒürenci olduƒüu yƒ±llarda kendini
                            hissettirmi≈üti. Yakla≈üƒ±k on iki yƒ±l √∂nce, mezun olur olmaz gen√ß bir k√ºt√ºphaneci olarak il
                            halk
                            k√ºt√ºphanesinde i≈üe ba≈üladƒ±. Bu s√ºre i√ßinde √∂nce katalog uzmanlƒ±ƒüƒ±ndan katalog birim
                            ≈üefliƒüine,
                            daha sonra ≈üeflikten teknik hizmetlerden sorumlu m√ºd√ºr yardƒ±mcƒ±lƒ±ƒüƒ±na hƒ±zlƒ± bir ≈üekilde
                            terfi etmesi
                            kimseyi ≈üa≈üƒ±rtmadƒ±. Bu hƒ±zlƒ± ilerleme herkes tarafƒ±ndan doƒüal ve hak edilmi≈ü bir ilerleme
                            olarak
                            kar≈üƒ±landƒ±. Fakat her ne olduysa izleyen zaman dilimi i√ßerisinde bu ilerleme durdu, √ßabalarƒ±
                            bunu
                            deƒüi≈ütirecek bir etki yaratmadƒ±.
                            Diƒüer √ßalƒ±≈üanlar tarafƒ±ndan ba≈üarƒ±lƒ±, saygƒ±n g√∂r√ºld√ºƒü√ºne, hatta bazen kararlƒ±
                            yakla≈üƒ±mlarƒ±ndan dolayƒ±
                            kendisinden biraz √ßekinildiƒüine inanmaktaydƒ±. Ufak tefek teredd√ºtlere raƒümen genel olarak
                            performansƒ±na ili≈ükin deƒüerlendirmeler hep olumluydu. K√ºt√ºphane √ºst y√∂neticilerinin,
                            personelin
                            hizmet-i√ßi eƒüitim etkinliklerine katƒ±lmasƒ±nƒ± √∂nemli g√∂rd√ºƒü√ºn√º, katƒ±lƒ±m g√∂sterenlere daha
                            olumlu
                            bakƒ±ldƒ±ƒüƒ±nƒ± duydu. Bu t√ºr eƒüitimlere sƒ±cak bakmamasƒ±na raƒümen sƒ±rf √ºst y√∂neticilerine
                            mesleƒüini ne
                            kadar √∂nemsediƒüine ili≈ükin bir mesaj g√∂nderme umuduyla d√ºzenlenen bir ki≈üisel geli≈üim
                            seminerine
                            katƒ±ldƒ±. Eƒüer bu da i≈üe yaramazsa ba≈üka bir kuruma ge√ßi≈üi se√ßenekleri arasƒ±nda
                            deƒüerlendirmekteydi.
                            Katƒ±ldƒ±ƒüƒ± bu ki≈üisel geli≈üim seminerinin ilk oturumunda t√ºm katƒ±lƒ±mcƒ±lardan yirmi maddeden
                            olu≈üan
                            bir Johari Penceresi Anketi doldurmalarƒ± istendi. Zafer Bey anketi tamamlayƒ±p, sonu√ßlarƒ±
                            deƒüerlendirdiƒüinde olu≈üan Johari Penceresi‚Äônin ≈üekildeki gibi olduƒüunu g√∂rd√º.
                            Zafer Bey‚Äôin √ñz Deƒüerlendirmesine bakƒ±ldƒ±ƒüƒ±nda a√ßƒ±k alanƒ±n olduk√ßa geni≈ü olduƒüu g√∂r√ºld√º
                            ancak Bu deƒüerlendirmeden sonra on iki katƒ±lƒ±mcƒ±dan olu≈üan grup kendilerine verilen bir
                            problem durumu
                            √ºzerinde ortak bir etkinlik y√ºr√ºtmeye ba≈üladƒ±. Grup √ßalƒ±≈ümasƒ± bir s√ºre a gayet eƒülenceli ve
                            etkili bir
                            ≈üekilde devam etti. Tam √ßalƒ±≈ümanƒ±n orta yerinde Zafer Bey‚Äôin olu≈üturulmasƒ± tasarlanan
                            k√ºt√ºphanedeki materyallerin sƒ±nƒ±flamasƒ±na ili≈ükin √∂nerisi kabul g√∂rmeyince kendini k√∂t√º
                            hissetti
                            √ß√ºnk√º √∂nerisinin doƒüru olduƒüu konusunda hi√ß ≈ü√ºphesi yoktu. Ger√ßekten de √∂nerisi yerindeydi
                            ve
                            grup bu √∂neriyi kabul etseydi grubun performansƒ± √ßok daha ba≈üarƒ±lƒ± olacaktƒ±.
                            Bu grup √ßalƒ±≈ümasƒ±ndan sonra seminer katƒ±lƒ±mcƒ±larƒ±ndan daha √∂nce kendileri i√ßin doldurduklarƒ±
                            Johari Penceresi anketlerini birbirleri i√ßin doldurmalarƒ± istendi. Zafer Bey i√ßin takƒ±mƒ±nƒ±n
                            verdiƒüi
                            ≈üekildeki geri bildirim net ve sarsƒ±cƒ±ydƒ±.
                            Zafer Bey‚Äôin Takƒ±mƒ±nƒ±n Verdiƒüi D√∂n√ºtte a√ßƒ±k alan olduk√ßa darken k√∂r ve bilinmeyen alan
                            olduk√ßa geni≈üti . Geri bildirimle hayal kƒ±rƒ±klƒ±ƒüƒ±na uƒürayan Zafer Bey‚Äôe katƒ±lƒ±mcƒ±
                            g√∂r√º≈ülerinin kendisini ≈üa≈üƒ±rtƒ±p
                            ≈üa≈üƒ±rtmadƒ±ƒüƒ± soruldu. Bir s√ºre d√º≈ü√ºnd√º, ya≈üadƒ±klarƒ±nƒ± g√∂zden ge√ßirdi. Oturum y√∂neticisi
                            kendisine
                            davranƒ±≈üƒ±nƒ± etkileyenin ne olduƒüunu sordu. Son olarak da onun takƒ±mdaki diƒüer √ºyeler
                            hakkƒ±nda ne
                            d√º≈ü√ºnd√ºƒü√ºn√º bilmek istediƒüini belirtti. Grubun kendi fikrine kar≈üƒ± √ßƒ±kmƒ±≈ü olmasƒ±ndan ba≈üka
                            s√∂yleyecek bir ≈üeyi olmadƒ±ƒüƒ±nƒ± fark etmesi onu hayrete d√º≈ü√ºrd√º. Kendisini g√∂zlem ve analiz
                            konusunda √ßok g√º√ßl√º bir olarak g√∂rmesine raƒümen s√∂yleyebileceƒüi kayda deƒüer bir ≈üey
                            olmadƒ±ƒüƒ±nƒ±
                            far ketti.
                            Ba≈ülangƒ±√ßtaki kƒ±zgƒ±nlƒ±ƒüƒ±nƒ±, sonrasƒ±ndaki mahcubiyetini ve devamƒ±ndaki rahatlamasƒ±nƒ± ve diƒüer
                            t√ºm
                            d√º≈ü√ºnce ve hislerini katƒ±lƒ±mcƒ±larla payla≈ütƒ±. Seminer g√ºn√ºn√ºn sonuna doƒüru k√ºt√ºphanede neden
                            daha fazla y√ºkselemediƒüini anlamaya ba≈üladƒ±. Hƒ±rslarƒ±nƒ±n yƒ±llarca kendisini nasƒ±l
                            t√ºkettiƒüini
                            g√∂rmeye ba≈üladƒ±. Seminerin devamƒ±nda da Zafer Bey kendini ke≈üfetmeye devam etti.
                        </div>
                    </details>

                    <script>
                        (function () {
                            // Sadece ilk kez a√ßƒ±ldƒ±ƒüƒ±nda metni i≈üle ve g√∂ster
                            const box = document.getElementById('hikayeBox');
                            const el = document.getElementById('hikayeMetni');

                            function hydrateOnce() {
                                if (el.dataset.hydrated === '1') { el.style.display = ''; return; }

                                let raw = el.textContent || "";
                                raw = raw.replace(/\r\n/g, '\n').replace(/\r/g, '\n');

                                const paras = raw
                                    .split(/\n{2,}/)
                                    .map(p => p.replace(/\n+/g, ' ').trim())
                                    .filter(Boolean);

                                const esc = s => s
                                    .replace(/&/g, '&amp;')
                                    .replace(/</g, '&lt;')
                                    .replace(/>/g, '&gt;');

                                el.innerHTML = paras
                                    .map(p => `<p style="margin:0 0 12px; line-height:1.7; text-align:justify; text-justify:inter-word;">${esc(p)}</p>`)
                                    .join('');

                                el.dataset.hydrated = '1';
                                el.style.display = '';
                            }

                            box.addEventListener('toggle', () => {
                                if (box.open) hydrateOnce();
                            });
                        })();
                    </script>

                </div>

                <!-- Right: Stats + Mail + AI comment -->
                <div class="card">
                    <h3>√ñzet G√∂stergeler</h3>
                    <div class="stats" id="stats">
                        <div class="stat">
                            <div class="ring" data-pct="{{ alanlar['acik_yuzde']|float }}">%{{ alanlar['acik_yuzde'] }}
                            </div>
                            <div class="txt"><b>A√ßƒ±k Alan</b><span>Payla≈üƒ±m & ≈üeffaflƒ±k</span></div>
                        </div>
                        <div class="stat">
                            <div class="ring" data-pct="{{ alanlar['kor_yuzde']|float }}">%{{ alanlar['kor_yuzde'] }}
                            </div>
                            <div class="txt"><b>K√∂r Alan</b><span>Geri bildirim ihtiyacƒ±</span></div>
                        </div>
                        <div class="stat">
                            <div class="ring" data-pct="{{ alanlar['gizli_yuzde']|float }}">%{{ alanlar['gizli_yuzde']
                                }}</div>
                            <div class="txt"><b>Gizli Alan</b><span>√ñz-a√ßƒ±m fƒ±rsatƒ±</span></div>
                        </div>
                        <div class="stat">
                            <div class="ring" data-pct="{{ alanlar['bilinmeyen_yuzde']|float }}">%{{
                                alanlar['bilinmeyen_yuzde'] }}</div>
                            <div class="txt"><b>Bilinmeyen</b><span>Ke≈üif & deneyim</span></div>
                        </div>
                    </div>

                    <div class="card" style="margin-top:14px">
                        <h3 style="margin-bottom:8px">Sonucu E-posta ile G√∂nder</h3>
                        <form class="mail" method="POST" action="{{ url_for('eposta_gonder') }}" id="mailForm">
                            <input type="hidden" name="yapan" value="{{ yapan }}">
                            <input type="hidden" name="grafik_path" value="{{ grafik_path }}">
                            <input type="hidden" name="alanlar_acik" value="{{ alanlar['acik_yuzde'] }}">
                            <input type="hidden" name="alanlar_kor" value="{{ alanlar['kor_yuzde'] }}">
                            <input type="hidden" name="alanlar_gizli" value="{{ alanlar['gizli_yuzde'] }}">
                            <input type="hidden" name="alanlar_bilinmeyen" value="{{ alanlar['bilinmeyen_yuzde'] }}">
                            <input type="hidden" name="yorum" value="{{ yorum }}">

                            <label for="eposta">E-posta adresi</label>
                            <div class="row">
                                <input type="email" id="eposta" name="eposta" required placeholder="ornek@gmail.com">
                                <button class="btn" type="submit" id="sendBtn">üì© G√∂nder</button>
                            </div>
                            <div class="hint" id="mailHint">Tek tƒ±k, saniyeler i√ßinde kutunda.</div>
                        </form>
                    </div>

                    <div class="ai" style="margin-top:14px">
                        <h3 style="margin:0 0 8px">SONU√á YORUMU </h3>
                        <h5 style="margin:0 0 8px">Bu yorumlar sadece sonuca √∂zel bir analizdir, ki≈üisel bir tahmindir.
                            </h3>
                            <div style="white-space:pre-wrap; line-height:1.65">{{ yorum }}</div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="foot">
                <small>Gizlilik: Sonu√ß dosyalarƒ± herkese a√ßƒ±k deƒüildir; yalnƒ±zca bu oturumda g√∂r√ºnt√ºlenir.</small>
                <small id="savedMsg">Otomatik kayƒ±t: Test cevaplarƒ± temizlendi.</small>
            </div>
        </div>
    </div>

    <script>
        // Y√ºzde halkalarƒ±nƒ± boya (conic-gradient)
        document.querySelectorAll('.ring').forEach(r => {
            const pct = Math.max(0, Math.min(100, parseFloat(r.dataset.pct || '0')));
            r.style.setProperty('--pct', pct);
        });

        // PDF yazdƒ±r
        document.getElementById('printBtn').addEventListener('click', () => window.print());

        // Mail: tek tƒ±k korumasƒ±
        const mailForm = document.getElementById('mailForm');
        const sendBtn = document.getElementById('sendBtn');
        const mailHint = document.getElementById('mailHint');
        mailForm.addEventListener('submit', (e) => {
            if (sendBtn.dataset.locked === '1') { e.preventDefault(); return; }
            sendBtn.dataset.locked = '1';
            sendBtn.textContent = 'G√∂nderiliyor‚Ä¶';
            sendBtn.style.opacity = '.85';
            mailHint.textContent = 'G√∂nderiliyor, l√ºtfen bekleyin‚Ä¶';
        });

        // Test sayfasƒ± otomatik kaydƒ±nƒ± temizle (varsa)
        try {
            for (let i = 0; i < localStorage.length; i++) {
                const k = localStorage.key(i);
                if (k && k.startsWith('johariCevaplar_v1')) { localStorage.removeItem(k); break; }
            }
        } catch (_) { }
    </script>
</body>

</html>