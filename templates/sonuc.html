<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <title>Johari Testi SonuÃ§larÄ±</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg1: #fdfcfb;
            --bg2: #e2d1c3;
            --ink: #1f2937;
            --muted: #6b7280;
            --fine: #9aa3b2;
            --accent: #8b5cf6;
            --accent2: #6a1b9a;
            --ok: #10b981;
            --warn: #f59e0b;
            --card: rgba(255, 255, 255, .92);
            --border: #e8e6f3;
            --shadow: 0 20px 60px rgba(30, 10, 60, .15);
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            color: var(--ink);
            background:
                radial-gradient(900px 500px at 10% 10%, rgba(139, 92, 246, .10), transparent 60%),
                linear-gradient(120deg, var(--bg1), var(--bg2));
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 28px 16px;
        }

        /* Shell + glass */
        .shell {
            width: min(1100px, 98vw);
            padding: 1px;
            border-radius: 24px;
            background: linear-gradient(120deg, rgba(139, 92, 246, .35), rgba(124, 58, 237, .18), rgba(139, 92, 246, .10));
            box-shadow: var(--shadow);
        }

        .kapsayici {
            border-radius: 23px;
            background: var(--card);
            backdrop-filter: saturate(120%) blur(5px);
            overflow: hidden
        }

        /* Header */
        .header {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 12px;
            padding: 26px 28px;
            border-bottom: 1px solid var(--border)
        }

        h1 {
            margin: 0;
            font-size: 28px;
            letter-spacing: .2px
        }

        .pair {
            color: var(--muted);
            font-weight: 600;
            margin-top: 6px
        }

        .chip {
            align-self: start;
            background: #f3e8ff;
            color: #6b21a8;
            font-weight: 700;
            font-size: 12px;
            padding: 8px 12px;
            border-radius: 999px
        }

        /* Grid */
        .grid {
            display: grid;
            grid-template-columns: 1.25fr .95fr;
            gap: 18px;
            padding: 22px 22px
        }

        @media (max-width:960px) {
            .grid {
                grid-template-columns: 1fr
            }
        }

        .card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 8px 26px rgba(0, 0, 0, .06)
        }

        .card h3 {
            margin: 0 0 10px;
            font-size: 18px
        }

        /* Graph */
        .grafik {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px
        }

        .grafik img {
            max-width: 100%;
            border-radius: 12px;
            border: 3px solid #e8defa
        }

        /* Stats rings */
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px
        }

        @media (max-width:560px) {
            .stats {
                grid-template-columns: 1fr 1fr
            }
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 14px;
            background: #fafaff
        }

        .ring {
            --pct: 0;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background:
                conic-gradient(var(--accent) calc(var(--pct)*1%), #ede9fe 0),
                radial-gradient(circle 28px, #fff 98%, transparent 100%);
            display: grid;
            place-items: center;
            font-weight: 800;
            color: #4b5563;
        }

        .stat .txt {
            line-height: 1.45
        }

        .stat .txt b {
            display: block;
            font-size: 14px
        }

        .stat .txt span {
            color: var(--muted);
            font-size: 12px
        }

        /* Actions */
        .actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center
        }

        .btn,
        .alink {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: linear-gradient(90deg, var(--accent), var(--accent2));
            color: #fff;
            font-weight: 700;
            text-decoration: none;
            cursor: pointer;
            box-shadow: 0 12px 30px rgba(124, 58, 237, .28);
            transition: transform .08s ease, box-shadow .2s ease, filter .2s ease
        }

        .btn:hover,
        .alink:hover {
            transform: translateY(-2px);
            box-shadow: 0 18px 34px rgba(124, 58, 237, .34);
            filter: saturate(1.05)
        }

        .btn.secondary {
            background: #fff;
            color: #334155;
            border-color: #e2e8f0;
            box-shadow: none;
        }

        .btn.secondary:hover {
            box-shadow: 0 8px 22px rgba(0, 0, 0, .08)
        }

        .hint {
            font-size: 12px;
            color: var(--fine)
        }

        /* Email card */
        .mail {
            display: grid;
            gap: 10px
        }

        .mail label {
            font-weight: 700;
            color: #374151
        }

        .mail input[type="email"] {
            padding: 12px 14px;
            border-radius: 12px;
            border: 1px solid #d1d5db;
            outline: none
        }

        .mail input[type="email"]:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, .20)
        }

        .mail .row {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap
        }

        /* Comment / Story */
        .ai {
            border-left: 5px solid var(--accent2);
            background: #fff;
            padding: 16px;
            border-radius: 12px
        }

        .story {
            margin-top: 12px
        }

        .story summary {
            list-style: none;
            cursor: pointer;
            padding: 12px 14px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: #fafafa;
            font-weight: 700;
            color: #4b5563;
        }

        .story summary::marker {
            display: none
        }

        .story[open] summary {
            background: #f4f0ff
        }

        /* Flash */
        .flash {
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 14px;
            font-weight: 600
        }

        .success {
            background: #e6f9e6;
            color: #27632a;
            border: 1px solid #a5d6a7
        }

        .error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a
        }

        /* Footer strip */
        .foot {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            padding: 12px 22px;
            border-top: 1px solid var(--border);
            background: #fff
        }

        .foot small {
            color: var(--fine)
        }
    </style>
</head>

<body>
    <div class="shell">
        <div class="kapsayici">
            <!-- Flash -->
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div style="padding:16px 22px 0">
                {% for category, message in messages %}
                <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}

            <!-- Header -->
            <div class="header">
                <div>
                    <h1>Johari Testi SonuÃ§larÄ±</h1>
                    <div class="pair">{{ yapan }} â†’ {{ test_edilen }}</div>
                </div>
                <div class="chip">Johari â€¢ 48 Soru</div>
            </div>

            <!-- Content -->
            <div class="grid">
                <!-- Left: Graph + Actions + Story -->
                <div class="card">
                    <h3>Johari Penceresi</h3>
                    <div class="grafik">
                        <img src="{{ url_for('static', filename=grafik_path) }}" alt="Johari Penceresi GrafiÄŸi">
                    </div>

                    <div class="actions" style="margin-top:8px">
                        <a class="alink" href="{{ url_for('indir_benim_sonucum') }}">â¬‡ï¸ Excel</a>

                        <button class="btn secondary" type="button" id="printBtn">ğŸ–¨ï¸ PDFâ€™e YazdÄ±r</button>
                        <a class="btn secondary" href="{{ url_for('giris') }}">â†©ï¸ Yeniden Dene</a>
                    </div>
                    <div class="hint" style="margin-top:6px">Ä°pucu: PDF yazdÄ±r seÃ§eneÄŸiyle bu sayfayÄ± doÄŸrudan PDF
                        olarak kaydedebilirsin.</div>

                    <!-- SADECE BURASI DEÄÄ°ÅTÄ°: open kaldÄ±rÄ±ldÄ± ve id eklendi -->
                    <details class="story" id="hikayeBox">
                        <summary>ğŸ“– Zafer Beyâ€™in Hikayesi</summary>

                        <!-- BaÅŸta gizli; JS ilk aÃ§Ä±lÄ±ÅŸta paragraflara dÃ¶nÃ¼ÅŸtÃ¼rÃ¼p gÃ¶sterecek -->
                        <div class="ai" id="hikayeMetni" style="margin-top:10px; display:none;">
                            <h3 style="margin:0 0 8px">Bilinenden Bilinmeyene: KÃ¼Ã§Ã¼k Bir DÃ¶nÃ¼ÅŸÃ¼m</h3>
                            Zafer beyin hikayesi : Zafer Beyâ€™in farklÄ± bir kÃ¼tÃ¼phaneci olacaÄŸÄ± henÃ¼z Ã¼niversitede
                            Ã¶ÄŸrenci olduÄŸu yÄ±llarda kendini
                            hissettirmiÅŸti. YaklaÅŸÄ±k on iki yÄ±l Ã¶nce, mezun olur olmaz genÃ§ bir kÃ¼tÃ¼phaneci olarak il
                            halk
                            kÃ¼tÃ¼phanesinde iÅŸe baÅŸladÄ±. Bu sÃ¼re iÃ§inde Ã¶nce katalog uzmanlÄ±ÄŸÄ±ndan katalog birim
                            ÅŸefliÄŸine,
                            daha sonra ÅŸeflikten teknik hizmetlerden sorumlu mÃ¼dÃ¼r yardÄ±mcÄ±lÄ±ÄŸÄ±na hÄ±zlÄ± bir ÅŸekilde
                            terfi etmesi
                            kimseyi ÅŸaÅŸÄ±rtmadÄ±. Bu hÄ±zlÄ± ilerleme herkes tarafÄ±ndan doÄŸal ve hak edilmiÅŸ bir ilerleme
                            olarak
                            karÅŸÄ±landÄ±. Fakat her ne olduysa izleyen zaman dilimi iÃ§erisinde bu ilerleme durdu, Ã§abalarÄ±
                            bunu
                            deÄŸiÅŸtirecek bir etki yaratmadÄ±.
                            DiÄŸer Ã§alÄ±ÅŸanlar tarafÄ±ndan baÅŸarÄ±lÄ±, saygÄ±n gÃ¶rÃ¼ldÃ¼ÄŸÃ¼ne, hatta bazen kararlÄ±
                            yaklaÅŸÄ±mlarÄ±ndan dolayÄ±
                            kendisinden biraz Ã§ekinildiÄŸine inanmaktaydÄ±. Ufak tefek tereddÃ¼tlere raÄŸmen genel olarak
                            performansÄ±na iliÅŸkin deÄŸerlendirmeler hep olumluydu. KÃ¼tÃ¼phane Ã¼st yÃ¶neticilerinin,
                            personelin
                            hizmet-iÃ§i eÄŸitim etkinliklerine katÄ±lmasÄ±nÄ± Ã¶nemli gÃ¶rdÃ¼ÄŸÃ¼nÃ¼, katÄ±lÄ±m gÃ¶sterenlere daha
                            olumlu
                            bakÄ±ldÄ±ÄŸÄ±nÄ± duydu. Bu tÃ¼r eÄŸitimlere sÄ±cak bakmamasÄ±na raÄŸmen sÄ±rf Ã¼st yÃ¶neticilerine
                            mesleÄŸini ne
                            kadar Ã¶nemsediÄŸine iliÅŸkin bir mesaj gÃ¶nderme umuduyla dÃ¼zenlenen bir kiÅŸisel geliÅŸim
                            seminerine
                            katÄ±ldÄ±. EÄŸer bu da iÅŸe yaramazsa baÅŸka bir kuruma geÃ§iÅŸi seÃ§enekleri arasÄ±nda
                            deÄŸerlendirmekteydi.
                            KatÄ±ldÄ±ÄŸÄ± bu kiÅŸisel geliÅŸim seminerinin ilk oturumunda tÃ¼m katÄ±lÄ±mcÄ±lardan yirmi maddeden
                            oluÅŸan
                            bir Johari Penceresi Anketi doldurmalarÄ± istendi. Zafer Bey anketi tamamlayÄ±p, sonuÃ§larÄ±
                            deÄŸerlendirdiÄŸinde oluÅŸan Johari Penceresiâ€™nin ÅŸekildeki gibi olduÄŸunu gÃ¶rdÃ¼.
                            Zafer Beyâ€™in Ã–z DeÄŸerlendirmesine bakÄ±ldÄ±ÄŸÄ±nda aÃ§Ä±k alanÄ±n oldukÃ§a geniÅŸ olduÄŸu gÃ¶rÃ¼ldÃ¼
                            ancak Bu deÄŸerlendirmeden sonra on iki katÄ±lÄ±mcÄ±dan oluÅŸan grup kendilerine verilen bir
                            problem durumu
                            Ã¼zerinde ortak bir etkinlik yÃ¼rÃ¼tmeye baÅŸladÄ±. Grup Ã§alÄ±ÅŸmasÄ± bir sÃ¼re a gayet eÄŸlenceli ve
                            etkili bir
                            ÅŸekilde devam etti. Tam Ã§alÄ±ÅŸmanÄ±n orta yerinde Zafer Beyâ€™in oluÅŸturulmasÄ± tasarlanan
                            kÃ¼tÃ¼phanedeki materyallerin sÄ±nÄ±flamasÄ±na iliÅŸkin Ã¶nerisi kabul gÃ¶rmeyince kendini kÃ¶tÃ¼
                            hissetti
                            Ã§Ã¼nkÃ¼ Ã¶nerisinin doÄŸru olduÄŸu konusunda hiÃ§ ÅŸÃ¼phesi yoktu. GerÃ§ekten de Ã¶nerisi yerindeydi
                            ve
                            grup bu Ã¶neriyi kabul etseydi grubun performansÄ± Ã§ok daha baÅŸarÄ±lÄ± olacaktÄ±.
                            Bu grup Ã§alÄ±ÅŸmasÄ±ndan sonra seminer katÄ±lÄ±mcÄ±larÄ±ndan daha Ã¶nce kendileri iÃ§in doldurduklarÄ±
                            Johari Penceresi anketlerini birbirleri iÃ§in doldurmalarÄ± istendi. Zafer Bey iÃ§in takÄ±mÄ±nÄ±n
                            verdiÄŸi
                            ÅŸekildeki geri bildirim net ve sarsÄ±cÄ±ydÄ±.
                            Zafer Beyâ€™in TakÄ±mÄ±nÄ±n VerdiÄŸi DÃ¶nÃ¼tte aÃ§Ä±k alan oldukÃ§a darken kÃ¶r ve bilinmeyen alan
                            oldukÃ§a geniÅŸti . Geri bildirimle hayal kÄ±rÄ±klÄ±ÄŸÄ±na uÄŸrayan Zafer Beyâ€™e katÄ±lÄ±mcÄ±
                            gÃ¶rÃ¼ÅŸlerinin kendisini ÅŸaÅŸÄ±rtÄ±p
                            ÅŸaÅŸÄ±rtmadÄ±ÄŸÄ± soruldu. Bir sÃ¼re dÃ¼ÅŸÃ¼ndÃ¼, yaÅŸadÄ±klarÄ±nÄ± gÃ¶zden geÃ§irdi. Oturum yÃ¶neticisi
                            kendisine
                            davranÄ±ÅŸÄ±nÄ± etkileyenin ne olduÄŸunu sordu. Son olarak da onun takÄ±mdaki diÄŸer Ã¼yeler
                            hakkÄ±nda ne
                            dÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼nÃ¼ bilmek istediÄŸini belirtti. Grubun kendi fikrine karÅŸÄ± Ã§Ä±kmÄ±ÅŸ olmasÄ±ndan baÅŸka
                            sÃ¶yleyecek bir ÅŸeyi olmadÄ±ÄŸÄ±nÄ± fark etmesi onu hayrete dÃ¼ÅŸÃ¼rdÃ¼. Kendisini gÃ¶zlem ve analiz
                            konusunda Ã§ok gÃ¼Ã§lÃ¼ bir olarak gÃ¶rmesine raÄŸmen sÃ¶yleyebileceÄŸi kayda deÄŸer bir ÅŸey
                            olmadÄ±ÄŸÄ±nÄ±
                            far ketti.
                            BaÅŸlangÄ±Ã§taki kÄ±zgÄ±nlÄ±ÄŸÄ±nÄ±, sonrasÄ±ndaki mahcubiyetini ve devamÄ±ndaki rahatlamasÄ±nÄ± ve diÄŸer
                            tÃ¼m
                            dÃ¼ÅŸÃ¼nce ve hislerini katÄ±lÄ±mcÄ±larla paylaÅŸtÄ±. Seminer gÃ¼nÃ¼nÃ¼n sonuna doÄŸru kÃ¼tÃ¼phanede neden
                            daha fazla yÃ¼kselemediÄŸini anlamaya baÅŸladÄ±. HÄ±rslarÄ±nÄ±n yÄ±llarca kendisini nasÄ±l
                            tÃ¼kettiÄŸini
                            gÃ¶rmeye baÅŸladÄ±. Seminerin devamÄ±nda da Zafer Bey kendini keÅŸfetmeye devam etti.
                        </div>
                    </details>

                    <script>
                        (function () {
                            // Sadece ilk kez aÃ§Ä±ldÄ±ÄŸÄ±nda metni iÅŸle ve gÃ¶ster
                            const box = document.getElementById('hikayeBox');
                            const el = document.getElementById('hikayeMetni');

                            function hydrateOnce() {
                                if (el.dataset.hydrated === '1') { el.style.display = ''; return; }

                                let raw = el.textContent || "";
                                raw = raw.replace(/\r\n/g, '\n').replace(/\r/g, '\n');

                                const paras = raw
                                    .split(/\n{2,}/)
                                    .map(p => p.replace(/\n+/g, ' ').trim())
                                    .filter(Boolean);

                                const esc = s => s
                                    .replace(/&/g, '&amp;')
                                    .replace(/</g, '&lt;')
                                    .replace(/>/g, '&gt;');

                                el.innerHTML = paras
                                    .map(p => `<p style="margin:0 0 12px; line-height:1.7; text-align:justify; text-justify:inter-word;">${esc(p)}</p>`)
                                    .join('');

                                el.dataset.hydrated = '1';
                                el.style.display = '';
                            }

                            box.addEventListener('toggle', () => {
                                if (box.open) hydrateOnce();
                            });
                        })();
                    </script>

                </div>

                <!-- Right: Stats + Mail + AI comment -->
                <div class="card">
                    <h3>Ã–zet GÃ¶stergeler</h3>
                    <div class="stats" id="stats">
                        <div class="stat">
                            <div class="ring" data-pct="{{ alanlar['acik_yuzde']|float }}">%{{ alanlar['acik_yuzde'] }}
                            </div>
                            <div class="txt"><b>AÃ§Ä±k Alan</b><span>PaylaÅŸÄ±m & ÅŸeffaflÄ±k</span></div>
                        </div>
                        <div class="stat">
                            <div class="ring" data-pct="{{ alanlar['kor_yuzde']|float }}">%{{ alanlar['kor_yuzde'] }}
                            </div>
                            <div class="txt"><b>KÃ¶r Alan</b><span>Geri bildirim ihtiyacÄ±</span></div>
                        </div>
                        <div class="stat">
                            <div class="ring" data-pct="{{ alanlar['gizli_yuzde']|float }}">%{{ alanlar['gizli_yuzde']
                                }}</div>
                            <div class="txt"><b>Gizli Alan</b><span>Ã–z-aÃ§Ä±m fÄ±rsatÄ±</span></div>
                        </div>
                        <div class="stat">
                            <div class="ring" data-pct="{{ alanlar['bilinmeyen_yuzde']|float }}">%{{
                                alanlar['bilinmeyen_yuzde'] }}</div>
                            <div class="txt"><b>Bilinmeyen</b><span>KeÅŸif & deneyim</span></div>
                        </div>
                    </div>

                    <div class="card" style="margin-top:14px">
                        <h3 style="margin-bottom:8px">Sonucu E-posta ile GÃ¶nder</h3>
                        <form class="mail" method="POST" action="{{ url_for('eposta_gonder') }}" id="mailForm">
                            <input type="hidden" name="yapan" value="{{ yapan }}">
                            <input type="hidden" name="grafik_path" value="{{ grafik_path }}">
                            <input type="hidden" name="alanlar_acik" value="{{ alanlar['acik_yuzde'] }}">
                            <input type="hidden" name="alanlar_kor" value="{{ alanlar['kor_yuzde'] }}">
                            <input type="hidden" name="alanlar_gizli" value="{{ alanlar['gizli_yuzde'] }}">
                            <input type="hidden" name="alanlar_bilinmeyen" value="{{ alanlar['bilinmeyen_yuzde'] }}">
                            <input type="hidden" name="yorum" value="{{ yorum }}">

                            <label for="eposta">E-posta adresi</label>
                            <div class="row">
                                <input type="email" id="eposta" name="eposta" required placeholder="ornek@gmail.com">
                                <button class="btn" type="submit" id="sendBtn">ğŸ“© GÃ¶nder</button>
                            </div>
                            <div class="hint" id="mailHint">Tek tÄ±k, saniyeler iÃ§inde kutunda.</div>
                        </form>
                    </div>

                    <div class="ai" style="margin-top:14px">
                        <h3 style="margin:0 0 8px">SONUÃ‡ YORUMU </h3>
                        <h5 style="margin:0 0 8px">Bu yorumlar sadece sonuca Ã¶zel bir analizdir, kiÅŸisel bir tahmindir.
                            </h3>
                            <div style="white-space:pre-wrap; line-height:1.65">{{ yorum }}</div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="foot">
                <small>Gizlilik: SonuÃ§ dosyalarÄ± herkese aÃ§Ä±k deÄŸildir; yalnÄ±zca bu oturumda gÃ¶rÃ¼ntÃ¼lenir.</small>
                <small id="savedMsg">Otomatik kayÄ±t: Test cevaplarÄ± temizlendi.</small>
            </div>
        </div>
    </div>

    <script>
        // YÃ¼zde halkalarÄ±nÄ± boya (conic-gradient)
        document.querySelectorAll('.ring').forEach(r => {
            const pct = Math.max(0, Math.min(100, parseFloat(r.dataset.pct || '0')));
            r.style.setProperty('--pct', pct);
        });

        // PDF yazdÄ±r
        document.getElementById('printBtn').addEventListener('click', () => window.print());

        // Mail: tek tÄ±k korumasÄ±
        const mailForm = document.getElementById('mailForm');
        const sendBtn = document.getElementById('sendBtn');
        const mailHint = document.getElementById('mailHint');
        mailForm.addEventListener('submit', (e) => {
            if (sendBtn.dataset.locked === '1') { e.preventDefault(); return; }
            sendBtn.dataset.locked = '1';
            sendBtn.textContent = 'GÃ¶nderiliyorâ€¦';
            sendBtn.style.opacity = '.85';
            mailHint.textContent = 'GÃ¶nderiliyor, lÃ¼tfen bekleyinâ€¦';
        });

        // Test sayfasÄ± otomatik kaydÄ±nÄ± temizle (varsa)
        try {
            for (let i = 0; i < localStorage.length; i++) {
                const k = localStorage.key(i);
                if (k && k.startsWith('johariCevaplar_v1')) { localStorage.removeItem(k); break; }
            }
        } catch (_) { }
    </script>
</body>

</html>